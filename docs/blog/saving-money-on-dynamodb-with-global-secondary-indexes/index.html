<!DOCTYPE html><html lang="en" data-theme="erudika"> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Saving money on DynamoDB with Global Secondary Indexes | Erudika</title><meta name="description" content="A tiny EU-based software company, building backend and serverless solutions."><link rel="canonical" href="https://erudika.com/blog/saving-money-on-dynamodb-with-global-secondary-indexes"><meta property="og:type" content="website"><meta property="og:title" content="Saving money on DynamoDB with Global Secondary Indexes | Erudika"><meta property="og:description" content="A tiny EU-based software company, building backend and serverless solutions."><meta property="og:url" content="https://erudika.com/blog/saving-money-on-dynamodb-with-global-secondary-indexes"><meta property="og:image" content="/src/images/img9.jpg"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Saving money on DynamoDB with Global Secondary Indexes | Erudika"><meta name="twitter:description" content="A tiny EU-based software company, building backend and serverless solutions."><meta name="twitter:image" content="/src/images/img9.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"Saving money on DynamoDB with Global Secondary Indexes","datePublished":"2016-11-21T00:00:00.000Z","dateModified":"2016-11-21T00:00:00.000Z","author":{"@type":"Organization","name":"Erudika"},"publisher":{"@type":"Organization","name":"Erudika","logo":{"@type":"ImageObject","url":"https://erudika.com/src/images/erudika-light.svg"}},"mainEntityOfPage":"https://erudika.com/blog/saving-money-on-dynamodb-with-global-secondary-indexes","image":["img9"],"url":"https://erudika.com/blog/saving-money-on-dynamodb-with-global-secondary-indexes"}</script><script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https://erudika.com"},{"@type":"ListItem","position":2,"name":"Blog","item":"https://erudika.com/blog"},{"@type":"ListItem","position":3,"name":"Saving money on DynamoDB with Global Secondary Indexes","item":"https://erudika.com/blog/saving-money-on-dynamodb-with-global-secondary-indexes"}]}</script><link rel="icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon-precomposed.png"><link rel="sitemap" href="/sitemap-index.xml"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="/_astro/about.BonHaEuI.css"></head> <body class="bg-base-100 min-h-screen text-base-content"> <div class="flex flex-col min-h-screen"> <header class="top-0 z-30 sticky bg-base-100/90 backdrop-blur border-base-300 border-b"> <div class="flex justify-between items-center gap-6 h-20 section-shell"> <a href="/" class="flex items-center text-base-content"> <span class="py-2 w-[140px] h-[50px] logo-frame"> <img src="/_astro/erudika-light.BVBbeAf1_1nUxeR.svg" alt="Erudika" loading="eager" decoding="async" fetchpriority="auto" width="463" height="107" class="logo-light"> <img src="/_astro/erudika-dark.4BCOIL6a_1nUxeR.svg" alt="Erudika" loading="eager" decoding="async" fetchpriority="auto" width="463" height="107" class="logo-dark"> </span> </a> <nav class="hidden md:flex items-center gap-6"> <a href="/projects" class="font-medium hover:text-sky-700 text-base text-base-content/70 transition"> Projects </a><a href="/blog" class="font-medium hover:text-sky-700 text-base text-base-content/70 transition"> Blog </a><a href="/support" class="font-medium hover:text-sky-700 text-base text-base-content/70 transition"> Support </a><a href="/contact" class="font-medium hover:text-sky-700 text-base text-base-content/70 transition"> Contact </a><a href="/about" class="font-medium hover:text-sky-700 text-base text-base-content/70 transition"> About </a> </nav> <div class="flex items-center gap-3"> <button class="btn btn-ghost btn-sm" onclick="site_search_modal.showModal()" aria-label="Open search" title="Search '/' or Ctrl+K"> <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"> <circle cx="11" cy="11" r="7"></circle> <path d="M20 20l-3.5-3.5"></path> </svg> </button> <a href="mailto:contact@erudika.com" class="hidden md:flex text-white btn btn-primary btn-sm">Contact Support</a> <div class="md:hidden dropdown dropdown-end"> <label tabindex="0" class="btn btn-ghost btn-sm"> Menu </label> <ul tabindex="0" class="bg-base-100 shadow mt-3 p-2 rounded-box w-auto menu dropdown-content"> <li class="flex content-end"><a href="/projects">Projects</a></li><li class="flex content-end"><a href="/blog">Blog</a></li><li class="flex content-end"><a href="/support">Support</a></li><li class="flex content-end"><a href="/contact">Contact</a></li><li class="flex content-end"><a href="/about">About</a></li> </ul> </div> </div> </div> </header> <dialog id="site_search_modal" class="modal"> <div class="top-24 absolute xs:w-full sm:w-10/12 md:w-6/12 max-w-3xl modal-box"> <!-- <div class="float-right flex justify-between items-center">
      <h3 class="font-semibold text-base-content text-lg">Search</h3>
      <label for="site_search_modal" class="btn btn-ghost btn-sm" aria-label="Close search">
        ‚úï
      </label>
    </div> --> <div class="mt-1"> <div class="flex items-center gap-2 w-full input input-bordered"> <svg xmlns="http://www.w3.org/2000/svg" class="opacity-70 w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"> <circle cx="11" cy="11" r="7"></circle> <path d="M20 20l-3.5-3.5"></path> </svg> <input id="site-search-input" type="search" list="options" class="grow" placeholder="Search‚Ä¶" role="combobox" aria-controls="searchbox" aria-expanded="true" aria-autocomplete="list"> </div> </div> <ul id="site-search-results" class="space-y-2 mt-3 text-sm"></ul> <div class="flex pt-4 text-xs"> <span class="grow"> <kbd class="kbd kbd-sm">‚ñ≤</kbd> <kbd class="kbd kbd-sm">‚ñº</kbd> <kbd class="kbd kbd-sm">Enter</kbd> to select,
<kbd class="kbd kbd-sm">Esc</kbd> to close
</span> <strong class="justify-end text-right"> <a href="https://paraio.com" target="_blank" class="text-base-content">
Search powered by <img src="/_astro/para.DRFwQDWW_ZiFrDU.webp" alt="Para" loading="eager" decoding="async" fetchpriority="auto" width="242" height="78" class="inline-block max-w-16"></a> </strong> </div> </div> <form method="dialog" class="modal-backdrop"> <button>close</button> </form> </dialog> <script type="module">const i=document.getElementById("site_search_modal"),l=document.getElementById("site-search-input"),n=document.getElementById("site-search-results"),u="<li>No Results</li>";let a,c,s=-1;const m=()=>{i&&i.showModal()},h=e=>{n&&(n.innerHTML=e.length===0?u:"",s=-1,e.forEach(t=>{const r=document.createElement("li"),o=document.createElement("a");o.href=t.url,o.textContent=t.name,o.className="block rounded-[3px] px-3 py-3",r.className="border border-base-300 hover:border-sky-700 rounded-[3px]",r.appendChild(o),n.appendChild(r)}))},d=e=>{if(!n)return;Array.from(n.querySelectorAll("li")).forEach((r,o)=>{o===e?r.classList.add("border-sky-700","bg-base-200"):r.classList.remove("border-sky-700","bg-base-200")})},f=async e=>{if(!n)return;const t=e.trim();if(!t){n.innerHTML="";return}a&&a.abort(),a=new AbortController;try{const r=await fetch(`https://paraio.com/v1/blogposts?limit=6&q=${encodeURIComponent(t||"*")}`,{signal:a.signal,headers:{Authorization:"Anonymous app:albogdano"}});if(!r.ok)return;const o=await r.json();h(Array.isArray(o.items)?o.items:[])}catch(r){r.name!=="AbortError"&&(n.innerHTML="")}};l&&(l.addEventListener("input",e=>{const t=e.target.value;clearTimeout(c),c=setTimeout(()=>{f(t)},250)}),l.addEventListener("keydown",e=>{if(!n)return;const t=Array.from(n.querySelectorAll("a"));t.length!==0&&(e.key==="ArrowDown"?(e.preventDefault(),s=(s+1)%t.length,d(s)):e.key==="ArrowUp"?(e.preventDefault(),s=(s-1+t.length)%t.length,d(s)):e.key==="Enter"&&s>=0&&(e.preventDefault(),t[s].click()))}));window.addEventListener("keydown",e=>{const t=e.key;if(t==="/"||t.toLowerCase()==="k"&&e.ctrlKey){e.preventDefault(),m();return}});</script> <main class="flex-1">  <div class="bg-cover bg-center" style="background-image: url('/src/images/img9.jpg')"> <div class="py-24 section-shell"> <div class="inline-flex flex-col gap-3 p-6 rounded-[3px] max-w-3xl">&nbsp;
</div> </div> </div> <article class="py-12"> <div class="max-w-3xl section-shell"> <span class="float-right text-xs text-base-400"> November 21, 2016 </span> <nav aria-label="Breadcrumb" class="text-xs uppercase tracking-widest text-slate-500"> <ol class="flex flex-wrap items-center gap-2"> <li class="flex items-center gap-2">  <a href="/" class="hover:text-sky-700"> Home </a> </li><li class="flex items-center gap-2"> <span class="text-slate-300">/</span> <a href="/blog" class="hover:text-sky-700"> Blog </a> </li> </ol> </nav> <h1 class="mt-6 font-semibold text-base-content text-4xl">Saving money on DynamoDB with Global Secondary Indexes</h1> <div class="flex flex-wrap gap-3 mt-4 pb-10 text-slate-500 text-sm"> <div class="flex flex-wrap gap-2"> <a href="/blog/tags/aws" class="bg-base-200 px-3 py-1 rounded-[3px] font-medium text-xs text-base-content/70"> aws </a><a href="/blog/tags/dynamodb" class="bg-base-200 px-3 py-1 rounded-[3px] font-medium text-xs text-base-content/70"> dynamodb </a><a href="/blog/tags/tips" class="bg-base-200 px-3 py-1 rounded-[3px] font-medium text-xs text-base-content/70"> tips </a> </div> </div> <div class="dark:prose-invert prose-img:rounded-xl max-w-none prose-h1:font-bold prose-a:text-primary prose-h1:text-xl prose-p:text-justify prose">  <p><strong>Amazon‚Äôs DynamoDB</strong> is a fully managed database service running inside the AWS cloud which is super-scalable and fast. It is perfect for write-intensive workflows and low-latency queries. Its main advantages are the adjustable read and write performance and global secondary indexes (GSI).</p>
<p>We migrated from Cassandra to DynamoDB a while back. This decision was taken mainly because of the tunable performance and also because it‚Äôs a managed service and we had one less thing to maintain. Later we found out that global indexes could help us save a lot of extra costs and so we implemented a simple solution, which we call ‚Äúshared tables‚Äù.</p>
<!-- more -->
<p><img alt="Blog media" loading="lazy" decoding="async" fetchpriority="auto" width="1280" height="720" src="/_astro/blogpost_media7.BTG515lf_1Ghbgk.webp" ></p>
<p>Our solution is applicable to cases where you have a large number of Dynamo tables but each of these has a low utilization. For example, it may contain a few hundred items and have low throughput capacity of 1 read and 1 write per second. The idea is to combine those tables into one and save some money. First, let‚Äôs look at this neat ASCII diagram of what we have so far.</p>
<pre>
 +-----+ +-----+ +-----+     +-----+
 | id1 | | id3 | | id5 |     | idX |
 +-----+ +-----+ +-----+ ... +-----+
 | id2 | | id4 | | id6 |     | idY |
 +-----+ +-----+ +-----+     +-----+
 Table 1 Table 2 Table 3     Table N

</pre>
<p>We are going to create a new table called <code>shared</code> and also we‚Äôll have to create the global secondary index to that table which is treated like a separate table. We can do this through the console or by calling the AWS SDK.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">boolean</span><span style="color:#B392F0"> createSharedTable</span><span style="color:#E1E4E8">(String sharedTableName, </span><span style="color:#F97583">long</span><span style="color:#E1E4E8"> readCapacity, </span><span style="color:#F97583">long</span><span style="color:#E1E4E8"> writeCapacity) {</span></span>
<span class="line"><span style="color:#F97583">  if</span><span style="color:#E1E4E8"> (</span><span style="color:#B392F0">existsTable</span><span style="color:#E1E4E8">(sharedTableName)) {</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#79B8FF"> false</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#F97583">  try</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">    // build the GSI request</span></span>
<span class="line"><span style="color:#E1E4E8">    GlobalSecondaryIndex secIndex </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> GlobalSecondaryIndex</span><span style="color:#E1E4E8">().</span></span>
<span class="line"><span style="color:#B392F0">        withIndexName</span><span style="color:#E1E4E8">(sharedTableName </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "-index"</span><span style="color:#E1E4E8">).</span></span>
<span class="line"><span style="color:#B392F0">        withProvisionedThroughput</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> ProvisionedThroughput</span><span style="color:#E1E4E8">().</span></span>
<span class="line"><span style="color:#B392F0">            withReadCapacityUnits</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1L</span><span style="color:#E1E4E8">).</span></span>
<span class="line"><span style="color:#B392F0">            withWriteCapacityUnits</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1L</span><span style="color:#E1E4E8">)).</span></span>
<span class="line"><span style="color:#B392F0">        withProjection</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Projection</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">withProjectionType</span><span style="color:#E1E4E8">(ProjectionType.ALL)).</span></span>
<span class="line"><span style="color:#B392F0">        withKeySchema</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> KeySchemaElement</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">withAttributeName</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"tableID"</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">withKeyType</span><span style="color:#E1E4E8">(KeyType.HASH),</span></span>
<span class="line"><span style="color:#F97583">            new</span><span style="color:#B392F0"> KeySchemaElement</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">withAttributeName</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"timestamp"</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">withKeyType</span><span style="color:#E1E4E8">(KeyType.RANGE));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // create the shared table with the above GSI attached</span></span>
<span class="line"><span style="color:#B392F0">    getClient</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">createTable</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> CreateTableRequest</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">withTableName</span><span style="color:#E1E4E8">(sharedTableName).</span></span>
<span class="line"><span style="color:#B392F0">        withKeySchema</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> KeySchemaElement</span><span style="color:#E1E4E8">(Config._KEY, KeyType.HASH)).</span></span>
<span class="line"><span style="color:#B392F0">        withAttributeDefinitions</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> AttributeDefinition</span><span style="color:#E1E4E8">(Config._KEY, ScalarAttributeType.S),</span></span>
<span class="line"><span style="color:#F97583">            new</span><span style="color:#B392F0"> AttributeDefinition</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"tableID"</span><span style="color:#E1E4E8">, ScalarAttributeType.S),</span></span>
<span class="line"><span style="color:#F97583">            new</span><span style="color:#B392F0"> AttributeDefinition</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"timestamp"</span><span style="color:#E1E4E8">, ScalarAttributeType.S)).</span></span>
<span class="line"><span style="color:#B392F0">        withGlobalSecondaryIndexes</span><span style="color:#E1E4E8">(secIndex).</span></span>
<span class="line"><span style="color:#B392F0">        withProvisionedThroughput</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> ProvisionedThroughput</span><span style="color:#E1E4E8">(readCapacity, writeCapacity)));</span></span>
<span class="line"><span style="color:#E1E4E8">  } </span><span style="color:#F97583">catch</span><span style="color:#E1E4E8"> (Exception </span><span style="color:#FFAB70">e</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">    logger.</span><span style="color:#B392F0">error</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Failed to create shared table."</span><span style="color:#E1E4E8">, e);</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#79B8FF"> false</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#79B8FF"> true</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>First we make a GSI request object by specifying its throughput ‚Äî 1 read/1 write is sufficient as a starting point. This setting is determined by the number of queries (per second) to the database. Then we specify the attributes which will be copied over to the secondary index (all in this case). This allows us to retrieve the data from the index directly instead of getting just the <code>id</code> from the index then reading the actual object from the <code>shared</code> table as a second request. Finally, and most importantly, we need to set the attributes on which the index is defined ‚Äî these will be <code>tableID</code> and <code>timestamp</code>. Going back to the first diagram, each table name will correspond to a <code>tableID</code> in the <code>shared</code> table. This will be the attribute which splits up the big table into smaller subtables (i.e. views). The <code>timestamp</code> field is used for sorting and is the so called ‚Äúrange‚Äù component of our index.</p>
<p>The result of the above request is going to be the table <code>shared</code> and the index <code>shared-index</code>.</p>
<pre>
  WRITE TO +          READ FROM ^
           |                    |
  +--------v---+      +---------+--+
  | table1_id1 |      | table1_id1 |
  +------------+      +------------+
  | table2_id3 |      | table1_id2 |
  +------------+      +------------+
  | table3_id5 |      | table2_id3 |
  +------------+      +------------+
  | table1_id2 |      | table2_id4 |
  +------------+      +------------+
  | table2_id4 +------+ table3_id5 |
  +------------+      +------------+
  | table3_id6 |      | table3_id6 |
  +------------+      +------------+
  |   . . .    |      |   . . .    |
  +------------+      +------------+
  | tableN_idX |      | tableN_idX |
  +------------+      +------------+
  | tableN_idY |      | tableN_idY |
  +------------+      +------------+
      shared           shared-index

</pre>
<p>The next important decision will be the format of the primary key in the <code>shared</code> table. We‚Äôve decided to go for <code>tableID_objectID</code> ‚Äî each object key is prefixed by the name of the table it belongs to. It‚Äôs a simple and effective way to avoid key collisions and make sure that a request coming from ‚Äútable1‚Äù cannot read the objects in ‚Äútable2‚Äù, for example.</p>
<p>Now, we have to modify our code to be able to make requests to the new shared table and to do that we wrote a simple ‚Äúrouting‚Äù function which gives us the correct key to an object in a shared table:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E1E4E8">String </span><span style="color:#B392F0">getKeyForTableID</span><span style="color:#E1E4E8">(String key, String tableID) {</span></span>
<span class="line"><span style="color:#6A737D">  // if table is shared return the composite key</span></span>
<span class="line"><span style="color:#F97583">  if</span><span style="color:#E1E4E8"> (</span><span style="color:#B392F0">isSharedTable</span><span style="color:#E1E4E8">(tableID)) {</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> tableID </span><span style="color:#F97583">+</span><span style="color:#9ECBFF"> "_"</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> key;</span></span>
<span class="line"><span style="color:#E1E4E8">  } </span><span style="color:#F97583">else</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> key;</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>So, if we had a read function in our code called <code>readObject(key, table)</code> this will have to be changed to <code>readObject(getKeyForTableID(key, table))</code>. Thus we can not only read from standard tables but also we can read object from our <code>shared</code> table. Finally, if we want to query multiple objects (pages of objects) from <code>shared</code> we do a scan operation on the global index instead of the original table.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E1E4E8">String </span><span style="color:#B392F0">readPageFromSharedTable</span><span style="color:#E1E4E8">(String tableID, String fromKey, List</span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8">Page</span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8">Item, QueryOutcome</span><span style="color:#F97583">>></span><span style="color:#E1E4E8"> results) {</span></span>
<span class="line"><span style="color:#E1E4E8">  ValueMap valueMap </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> ValueMap</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">withString</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">":tid"</span><span style="color:#E1E4E8">, tableID);</span></span>
<span class="line"><span style="color:#E1E4E8">  valueMap.</span><span style="color:#B392F0">put</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">":ts"</span><span style="color:#E1E4E8">, fromKey);</span></span>
<span class="line"><span style="color:#E1E4E8">  Index index </span><span style="color:#F97583">=</span><span style="color:#B392F0"> getSharedIndex</span><span style="color:#E1E4E8">(tableID);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">  QuerySpec spec </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> QuerySpec</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">withMaxPageSize</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">100</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">withMaxResultSize</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">100</span><span style="color:#E1E4E8">).</span></span>
<span class="line"><span style="color:#B392F0">      withKeyConditionExpression</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"tableID = :tid and timestamp > :ts"</span><span style="color:#E1E4E8">).</span></span>
<span class="line"><span style="color:#B392F0">      withValueMap</span><span style="color:#E1E4E8">(valueMap);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">  Page&#x3C;</span><span style="color:#F97583">Item</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">QueryOutcome</span><span style="color:#E1E4E8">> items </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> index.</span><span style="color:#B392F0">query</span><span style="color:#E1E4E8">(spec);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  if</span><span style="color:#E1E4E8"> (items.</span><span style="color:#B392F0">hasNextPage</span><span style="color:#E1E4E8">()) {</span></span>
<span class="line"><span style="color:#E1E4E8">    results.</span><span style="color:#B392F0">add</span><span style="color:#E1E4E8">(items.</span><span style="color:#B392F0">firstPage</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#6A737D">    // return last key as a start key to next page</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> items.</span><span style="color:#B392F0">getLowLevelResult</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">getQueryResult</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">getLastEvaluatedKey</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">get</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"timestamp"</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">getS</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">  } </span><span style="color:#F97583">else</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#79B8FF"> null</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="conclusion">Conclusion</h2>
<p>Alright, we have combined several tables into one, but how is that going to affect our AWS bill at the end of the month? Let‚Äôs do some simple calculations. At the time of writing, a table with 1/1 throughput costs <strong>$0.66/month</strong>. This is the minimum cost of a table per month. If we had 100 small tables in the beginning, we‚Äôd have to pay <strong>(100 * 0.66) = $66 per month</strong>. That‚Äôs a lot, especially if our tables were underutilized. The shared table with a global secondary index would cost a mere <strong>$1.32/month</strong> for the minimum capacity of 1 read/s and 1 write/s. That‚Äôs a <em>50x</em> cost reduction ‚Äî good job!</p>
<p><em>If you liked this post, you should check out <a href="https://paraio.com">Para</a> - our backend service for busy developers. Also, chat with us <a href="https://gitter.im/Erudika/para">on Gitter</a>!</em></p>  </div> <div class="mt-10 text-center section-shell"> <p class="font-semibold text-slate-500 text-xs uppercase tracking-[0.3em]">About the author</p> <div class="flex flex-wrap justify-center gap-4 mt-6"> <div class="flex items-center gap-3 bg-base-100 px-4 py-4 border border-base-300 rounded-[10px]"> <div> <img src="https://gravatar.com/avatar/6888890e3e742a7c7357a4c74be405b8?s=400&d=robohash&r=x" alt="Avatar" loading="lazy" decoding="async" fetchpriority="auto" width="400" height="400" class="flex justify-center items-center bg-indigo-600 rounded-full w-16 h-16 font-semibold text-white text-sm"> </div> <div class="font-semibold text-sm text-base-content">Alexander Bogdanovski <br> <span class="text-xs">Founder &amp; Indie Hacker</span> </div> </div> </div> </div> </div> </article>  </main> <footer class="bg-slate-950 border-base-300 border-t text-slate-200"> <div class="section-shell"> <div class="gap-10 grid md:grid-cols-2 lg:grid-cols-[1.1fr_1.6fr_1fr_0.7fr] py-12"> <div class="space-y-4"> <div class="flex items-center"> <span class="w-[130px] h-[40px] logo-frame"> <img src="/_astro/erudika-dark.4BCOIL6a_1nUxeR.svg" alt="Erudika" loading="lazy" decoding="async" fetchpriority="auto" width="463" height="107"> </span> </div> <p class="max-w-sm text-slate-300 text-sm">A tiny EU-based software company, building backend and serverless solutions.</p> </div> <div class="space-y-3"> <div class="text-slate-500 text-xs uppercase tracking-widest">Location</div> <a href="https://goo.gl/maps/QGRjd" aria-label="Open Erudika office location in Google Maps"> <img src="/_astro/erudika_map_dark.C1f1c8Db_Zji672.webp" alt="Erudika Office Location" loading="lazy" decoding="async" fetchpriority="auto" width="791" height="506" class="shadow-soft border border-slate-500 rounded-[3px] w-full"> </a> </div> <div class="space-y-4 text-slate-300 text-sm"> <div class="text-slate-500 text-xs uppercase tracking-widest">Address</div> <div>Erudika LTD.</div><div>4 Lelinska chuka Street</div><div>Sofia 1618, Bulgaria</div><div>VAT# BG-200368755</div><div>Phone: +359 886 000 995</div><div><a class="underline" href="mailto:support@erudika.com">support@erudika.com</a></div> </div> <div class="lg:justify-self-end content-start gap-3 grid text-sm lg:text-right"> <div class="text-slate-500 text-xs uppercase tracking-widest">Links</div> <a href="/projects" class="text-slate-300 hover:text-white">Projects</a><a href="/blog" class="text-slate-300 hover:text-white">Blog</a><a href="/support" class="text-slate-300 hover:text-white">Support</a><a href="/contact" class="text-slate-300 hover:text-white">Contact</a><a href="/about" class="text-slate-300 hover:text-white">About</a><a href="/privacy" class="text-slate-300 hover:text-white">Privacy</a><a href="https://status.erudika.com" class="text-slate-300 hover:text-white">üü¢ Status Page</a> </div> </div> <div class="flex flex-wrap justify-between items-center gap-4 py-6 border-slate-800 border-t text-slate-400 text-xs"> <div class="flex items-center gap-3"> <span class="text-slate-500 text-xs uppercase tracking-widest">Theme</span> <button id="theme-toggle" class="bg-slate-900 border border-slate-700 hover:border-slate-500 text-slate-200 btn btn-xs" type="button"> System </button> </div> <div class="flex flex-wrap items-center gap-4"> <a href="https://github.com/Erudika" class="text-slate-400 hover:text-white">GitHub</a><a href="https://hub.docker.com/u/erudikaltd" class="text-slate-400 hover:text-white">Docker Hub</a><a href="https://x.com/erudika" class="text-slate-400 hover:text-white">X.com</a><a href="https://www.linkedin.com/company/erudika" class="text-slate-400 hover:text-white">LinkedIn</a> </div> </div> </div> </footer> </div> <script>(function(){const theme = {"storageKey":"erudika-theme","light":"corporate","dark":"business","labelLight":"Light","labelDark":"Dark","labelSystem":"System"};

      const themeConfig = theme;

      const themeToggle = document.getElementById("theme-toggle");

      const getPreferredTheme = () => {
        const stored = localStorage.getItem(themeConfig.storageKey);
        if (stored === themeConfig.light || stored === themeConfig.dark) {
          return stored;
        }
        return window.matchMedia("(prefers-color-scheme: dark)").matches
          ? themeConfig.dark
          : themeConfig.light;
      };

      const applyTheme = (nextTheme, label) => {
        document.documentElement.setAttribute("data-theme", nextTheme);
        if (themeToggle) {
          themeToggle.textContent = label;
        }
      };

      const syncTheme = () => {
        const nextTheme = getPreferredTheme();
        const label = localStorage.getItem(themeConfig.storageKey)
          ? nextTheme === themeConfig.dark
            ? themeConfig.labelDark
            : themeConfig.labelLight
          : themeConfig.labelSystem;
        applyTheme(nextTheme, label);
      };

      syncTheme();

      window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change", () => {
        if (!localStorage.getItem(themeConfig.storageKey)) {
          syncTheme();
        }
      });

      if (themeToggle) {
        themeToggle.addEventListener("click", () => {
          const current = document.documentElement.getAttribute("data-theme") || themeConfig.light;
          const nextTheme = current === themeConfig.dark ? themeConfig.light : themeConfig.dark;
          localStorage.setItem(themeConfig.storageKey, nextTheme);
          applyTheme(nextTheme, nextTheme === themeConfig.dark ? themeConfig.labelDark : themeConfig.labelLight);
        });
      }
    })();</script> </body> </html>