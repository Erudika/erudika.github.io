---
import marketing from "../data/site-data.json";
import { Image } from "astro:assets";
import Prose from '../components/Prose.astro';

const { projectPage } = marketing.site.pages;
const { project } = Astro.props;

const markdownDescription = await import(`../content/projects/${project.id}.md`);
const markdownLicense = await import(`../content/projects/${project.id}-license.md`);
// const markdownModule = markdownKey ? markdownModules[markdownKey] : null;
const MarkdownContent = markdownDescription ? await markdownDescription.Content : null;
const MarkdownLicenseContent = markdownLicense ? await markdownLicense.Content : null;
---

<section class="py-10">
  <div class="section-shell">
    <a href="/projects" class="inline-flex items-center gap-2 font-semibold text-sky-700 text-sm">
      <span aria-hidden="true">←</span>
      {projectPage.backLabel}
    </a>

    <div class="gap-8 grid lg:grid-cols-[280px_1fr] mt-8">
      <aside class="space-y-5">
        <div class="bg-base-100 shadow-sm p-6 border border-base-300 rounded-[6px]">
          <div class="flex justify-center items-center bg-base-200 p-6 border border-base-300 rounded-[6px]">
            {project.logo && <Image src={import(`../images/${project.logo}.svg`)} alt={project.name} class="w-auto h-32"/>}
          </div>
          <div class="gap-3 grid mt-5">
            <a href={project.website} class="text-white btn btn-primary btn-sm">{projectPage.primaryCta}</a>
          </div>
        </div>

        <div class="bg-base-100 p-6 border border-base-300 rounded-[6px] text-sm">
          <div class="font-semibold text-slate-500 text-xs uppercase tracking-widest">{projectPage.techStackLabel}</div>
          <div class="mt-2 text-base-content/80">{project.page.techStack}</div>

          <div class="mt-5 font-semibold text-slate-500 text-xs uppercase tracking-widest">{projectPage.pricingLabel}</div>
          <div class="mt-2 text-base-content/80">{project.page.pricing}</div>

          <div class="mt-5 font-semibold text-slate-500 text-xs uppercase tracking-widest">{projectPage.supportLabel}</div>
          <div class="space-y-2 mt-3">
            {Object.keys(project.page.supportLinks).map((linkType) => (
              // {projectPage.supportLinks}
              <a
                class="flex items-center gap-2 text-sky-700"
                href={project.page.supportLinks[linkType]}
              >
                <span aria-hidden="true">↗</span>
                {projectPage.supportLinks.filter((l) => l.type === linkType)[0].label}
              </a>
            ))}
          </div>
        </div>

        <div class="bg-base-100 p-6 border border-base-300 rounded-[6px] text-sm">
          <div class="font-semibold text-slate-500 text-xs uppercase tracking-widest">{projectPage.categoriesLabel}</div>
          <div class="flex flex-wrap gap-2 mt-3">
            {project.page.categories.map((category) => (
              <span class="bg-base-200 px-3 py-1 border border-base-300 rounded-full text-xs text-base-content/70">
                {category}
              </span>
            ))}
          </div>
        </div>
      </aside>

      <div>
        <div class="flex flex-wrap items-center gap-4">
          <h1 class="font-semibold text-base-content text-3xl sm:text-4xl">{project.name}</h1>
          <span class="bg-base-200 px-3 py-1 border border-base-300 rounded-full font-semibold text-xs text-base-content/70">
            {project.category}
          </span>
        </div>
        <p class="mt-3 text-base-content/70 text-lg">{project.tagline}</p>

        <div class="mt-6 border-base-300 border-b font-semibold text-sm text-base-content/70" data-tabs>
          <div role="tablist" class="tabs-border tabs">
            {projectPage.tabs.map((tab, index) => (
              <button
                role="tab"
                type="button"
                data-tab={index}
                class={`tab pb-3 ${index == 0 ? "tab-active" : ""}`}
              >
                {tab}
              </button>
            ))}
          </div>
        </div>

        <div class="bg-base-100 shadow-sm mt-8 p-8 border border-base-300 rounded-[6px]">
          <div data-panel="0">
            {project.page.screenshot && (
              <div class="bg-base-100 p-1 border border-base-300 rounded-[6px]">
                <Image src={import(`../images/${project.page.screenshot}.png`)} alt={`${project.name} preview`} class="mx-auto rounded-[6px] w-auto max-h-100" />
              </div>
            )}
            <div class="space-y-4 mt-6 text-base-content/80">
              {MarkdownContent ? <Prose><MarkdownContent /></Prose> : <p> </p>}
            </div>
          </div>
          <div data-panel="1" class="hidden">
            <p class="text-base-content/80">{MarkdownLicenseContent ? <MarkdownLicenseContent /> : <p>N/A</p>}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  const tabButtons = document.querySelectorAll("[data-tabs] [data-tab]");
  const panels = document.querySelectorAll("[data-panel]");

  const setActive = (index) => {
    tabButtons.forEach((button) => {
      const isActive = (button as HTMLElement).dataset.tab === String(index);
      button.classList.toggle("tab-active", isActive);
    });
    panels.forEach((panel) => {
      panel.classList.toggle("hidden", (panel as HTMLElement).dataset.panel !== String(index));
    });
  };

  tabButtons.forEach((button) => {
    button.addEventListener("click", () => setActive((button as HTMLElement).dataset.tab));
  });
</script>
