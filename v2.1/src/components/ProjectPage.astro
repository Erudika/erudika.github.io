---
import marketing from "../data/site-data.json";
import { Image } from 'astro:assets';

const { projectPage } = marketing.site.pages;
const { project } = Astro.props;
---

<section class="py-10">
  <div class="section-shell">
    <a href="/projects" class="inline-flex items-center gap-2 text-sm font-semibold text-sky-700">
      <span aria-hidden="true">←</span>
      {projectPage.backLabel}
    </a>

    <div class="mt-8 grid gap-8 lg:grid-cols-[280px_1fr]">
      <aside class="space-y-5">
        <div class="rounded-[6px] border border-base-300 bg-base-100 p-6 shadow-sm">
          <div class="flex items-center justify-center rounded-[6px] border border-base-300 bg-base-200 p-6">
            {project.logo && <Image src={import(project.logo)} alt={project.name} class="h-32 w-auto"/>}
          </div>
          <div class="mt-5 grid gap-3">
            <a href={project.website} class="btn btn-primary btn-sm text-white">{projectPage.primaryCta}</a>
          </div>
        </div>

        <div class="rounded-[6px] border border-base-300 bg-base-100 p-6 text-sm">
          <div class="text-xs font-semibold uppercase tracking-widest text-slate-500">{projectPage.techStackLabel}</div>
          <div class="mt-2 text-base-content/80">{project.page.techStack}</div>

          <div class="mt-5 text-xs font-semibold uppercase tracking-widest text-slate-500">{projectPage.pricingLabel}</div>
          <div class="mt-2 text-base-content/80">{project.page.pricing}</div>

          <div class="mt-5 text-xs font-semibold uppercase tracking-widest text-slate-500">{projectPage.supportLabel}</div>
          <div class="mt-3 space-y-2">
            {projectPage.supportLinks.map((link) => (
              <a
                class="flex items-center gap-2 text-sky-700"
                href={project.page.supportLinks[link.type]}
              >
                <span aria-hidden="true">↗</span>
                {link.label}
              </a>
            ))}
          </div>
        </div>

        <div class="rounded-[6px] border border-base-300 bg-base-100 p-6 text-sm">
          <div class="text-xs font-semibold uppercase tracking-widest text-slate-500">{projectPage.categoriesLabel}</div>
          <div class="mt-3 flex flex-wrap gap-2">
            {project.page.categories.map((category) => (
              <span class="rounded-full border border-base-300 bg-base-200 px-3 py-1 text-xs text-base-content/70">
                {category}
              </span>
            ))}
          </div>
        </div>
      </aside>

      <div>
        <div class="flex flex-wrap items-center gap-4">
          <h1 class="text-3xl font-semibold text-base-content sm:text-4xl">{project.name}</h1>
          <span class="rounded-full border border-base-300 bg-base-200 px-3 py-1 text-xs font-semibold text-base-content/70">
            {project.category}
          </span>
        </div>
        <p class="mt-3 text-lg text-base-content/70">{project.tagline}</p>

        <div class="mt-6 border-b border-base-300 text-sm font-semibold text-base-content/70" data-tabs>
          <div role="tablist" class="tabs tabs-border">
            {projectPage.tabs.map((tab, index) => (
              <button
                role="tab"
                type="button"
                data-tab={index}
                class={`tab pb-3 ${index == 0 ? "tab-active" : ""}`}
              >
                {tab}
              </button>
            ))}
          </div>
        </div>

        <div class="mt-8 rounded-[6px] border border-base-300 bg-base-100 p-8 shadow-sm">
          <div data-panel="0">
            {project.page.screenshot && (
              <div class="rounded-[6px] border border-base-300 bg-base-100 p-1">
                <Image src={import(project.page.screenshot)} alt={`${project.name} preview`} class="mx-auto max-h-100 w-auto rounded-[6px]" />
              </div>
            )}
            <div class="mt-6 space-y-4 text-base-content/80">
              <p>{project.page.longDescription}</p>
            </div>
          </div>
          <div data-panel="1" class="hidden">
            <p class="text-base-content/80">{project.page.permissions}</p>
          </div>
          <div data-panel="2" class="hidden">
            <p class="text-base-content/80">{project.page.security}</p>
          </div>
          <div data-panel="3" class="hidden">
            <p class="text-base-content/80">{project.page.license}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  const tabButtons = document.querySelectorAll("[data-tabs] [data-tab]");
  const panels = document.querySelectorAll("[data-panel]");

  const setActive = (index) => {
    tabButtons.forEach((button) => {
      const isActive = (button as HTMLElement).dataset.tab === String(index);
      button.classList.toggle("tab-active", isActive);
    });
    panels.forEach((panel) => {
      panel.classList.toggle("hidden", (panel as HTMLElement).dataset.panel !== String(index));
    });
  };

  tabButtons.forEach((button) => {
    button.addEventListener("click", () => setActive((button as HTMLElement).dataset.tab));
  });
</script>
