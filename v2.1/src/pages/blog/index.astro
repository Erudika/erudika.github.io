---
import BaseLayout from "../../layouts/BaseLayout.astro";
import BlogCard from "../../components/BlogCard.astro";
import Pagination from "../../components/Pagination.astro";
import { getCollection } from "astro:content";
import marketing from "../../data/site-data.json";

const { blogIndex } = marketing.site.pages;
const baseUrl = marketing.site.organization.url;

const PAGE_SIZE = 15;
const posts = (await getCollection("blog")).sort(
  (a, b) => b.data.date.valueOf() - a.data.date.valueOf()
);

const totalPages = Math.max(1, Math.ceil(posts.length / PAGE_SIZE));
const pagePosts = posts.slice(0, PAGE_SIZE).map((post) => ({
  title: post.data.title,
  excerpt: post.data.excerpt,
  date: post.data.date.toLocaleDateString("en-US", {
    year: "numeric",
    month: "short",
    day: "2-digit"
  }),
  img: post.data.img,
  tags: post.data.tags,
  href: `/blog/${post.slug}`
}));

const breadcrumbJsonLd = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  itemListElement: [
    { "@type": "ListItem", position: 1, name: marketing.site.components.breadcrumbs.home, item: baseUrl },
    { "@type": "ListItem", position: 2, name: marketing.site.components.breadcrumbs.blog, item: `${baseUrl}/blog` }
  ]
};
---

<BaseLayout
  title={marketing.site.meta.blogIndex.title}
  description={marketing.site.meta.blogIndex.description}
  canonical={marketing.site.meta.blogIndex.canonical}
  jsonLd={breadcrumbJsonLd}
>
  <section class="pb-16">
    <div class="bg-[url('/src/images/banner.jpg')] bg-cover bg-center">
      <div class="py-12 section-shell">
        <div class="inline-flex flex-col gap-3 bg-base-100/85 shadow-soft backdrop-blur-sm p-6 rounded-[3px] ring-1 ring-base-300/60 max-w-3xl">
          <p class="font-semibold text-slate-500 text-xs uppercase tracking-[0.3em]">{blogIndex.eyebrow}</p>
          <h1 class="font-semibold text-base-content text-4xl">{blogIndex.title}</h1>
          <p class="text-base-content/70 text-lg">{blogIndex.body}</p>
          <div>
            <a href="/blog/tags" class="font-semibold text-sky-700 text-sm">{blogIndex.tagsCta}</a>
          </div>
        </div>
      </div>
    </div>
    <div class="section-shell">
      <div class="gap-6 grid md:grid-cols-2 xl:grid-cols-3 mt-10">
        {pagePosts.map((post) => (
          <BlogCard {...post} />
        ))}
      </div>
      <Pagination currentPage={1} totalPages={totalPages} />
    </div>
  </section>
</BaseLayout>
