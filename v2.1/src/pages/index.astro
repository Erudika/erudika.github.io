---
import BaseLayout from "../layouts/BaseLayout.astro";
import ProjectCard from "../components/ProjectCard.astro";
import BlogCard from "../components/BlogCard.astro";
import MetricCard from "../components/MetricCard.astro";
import marketing from "../data/site-data.json";
import { getCollection } from "astro:content";

const { hero, proofPoints } = marketing;
const { home } = marketing.site.pages;
const projects = marketing.site.pages.projectsIndex.items;

const blogTeasers = (await getCollection("blog"))
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 3)
  .map((post) => ({
    title: post.data.title,
    excerpt: post.data.excerpt,
    date: post.data.date.toLocaleDateString("en-US", {
      year: "numeric",
      month: "short",
      day: "2-digit"
    }),
    img: post.data.img,
    tags: post.data.tags,
    href: `/blog/${post.slug}`
  }));

const orgJsonLd = {
  "@context": "https://schema.org",
  "@type": "Organization",
  name: marketing.site.organization.name,
  url: marketing.site.organization.url,
  logo: marketing.site.organization.logo,
  email: marketing.site.organization.email,
  address: {
    "@type": "PostalAddress",
    streetAddress: marketing.site.organization.address.street,
    addressLocality: marketing.site.organization.address.locality,
    postalCode: marketing.site.organization.address.postalCode,
    addressCountry: marketing.site.organization.address.country
  }
};

const websiteJsonLd = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  name: marketing.site.organization.name,
  url: marketing.site.organization.url,
  publisher: {
    "@type": "Organization",
    name: marketing.site.organization.name
  }
};
---

<BaseLayout
  title={marketing.site.meta.home.title}
  description={marketing.site.meta.home.description}
  canonical={marketing.site.meta.home.canonical}
  jsonLd={[orgJsonLd, websiteJsonLd]}
>
  <section class="hero-grid py-20 border-base-300 border-b">
    <div class="section-shell">
      <div class="flex flex-col items-center mx-auto max-w-3xl text-center">
        <p class="font-semibold text-slate-500 text-xs uppercase tracking-[0.3em]">{hero.eyebrow}</p>
        <div class="space-y-4 mt-6">
          <h1 class="font-semibold text-base-content text-4xl sm:text-5xl leading-tight">{hero.title}</h1>
          <p class="text-base-content/70 text-lg">{hero.subtitle}</p>
        </div>
        <div class="flex flex-wrap justify-center gap-3 mt-6">
          {hero.badges.map((badge) => (
            <div class="bg-sky-50 px-4 py-2 border border-sky-100 rounded-[3px] font-semibold text-sky-700 text-xs">
              {badge.label}
              <span class="block font-normal text-[11px] text-sky-500">{badge.description}</span>
            </div>
          ))}
        </div>
        <div class="flex flex-wrap justify-center gap-4 mt-8">
          <a href={hero.primaryCta.href} class="text-white btn btn-primary">
            {hero.primaryCta.label}
          </a>
          <a href={hero.secondaryCta.href} class="border border-slate-300 btn btn-ghost">
            {hero.secondaryCta.label}
          </a>
        </div>
      </div>
    </div>
  </section>

  <section id="projects" class="py-16">
    <div class="section-shell">
      <div class="flex flex-wrap justify-between items-end gap-6">
        <div>
          <p class="font-semibold text-slate-500 text-xs uppercase tracking-[0.3em]">{home.projectsLabel}</p>
          <h2 class="mt-3 font-semibold text-base-content text-3xl">{home.projectsTitle}</h2>
          <p class="mt-3 max-w-2xl text-base-content/70">{home.projectsBody}</p>
        </div>
        <a href="/projects" class="font-semibold text-sky-700 text-sm">{home.projectsCta}</a>
      </div>
      <div class="gap-6 grid md:grid-cols-2 xl:grid-cols-3 mt-10">
        {projects.slice(0, 3).map((project) => (
          <ProjectCard
            name={project.name}
            tagline={project.tagline}
            category={project.category}
            cta={project.cta}
            signal={project.signal}
            logo={project.logo}
          />
        ))}
      </div>
    </div>
  </section>

  <section class="bg-base-100 py-16 border-base-300 border-t">
    <div class="gap-10 grid lg:grid-cols-[0.8fr_1.2fr] section-shell">
      <div>
        <p class="font-semibold text-slate-500 text-xs uppercase tracking-[0.3em]">{home.proofLabel}</p>
        <h2 class="mt-3 font-semibold text-base-content text-3xl">{home.proofTitle}</h2>
        <p class="mt-3 text-base-content/70">{home.proofBody}</p>
      </div>
      <div class="gap-4 grid sm:grid-cols-3">
        {proofPoints.metrics.map((metric) => (
          <MetricCard label={metric.label} value={metric.value} description={metric.description} />
        ))}
      </div>
    </div>
    <!-- <div class="gap-6 grid md:grid-cols-2 mt-10 section-shell">
      {proofPoints.testimonials.map((testimonial) => (
        <div class="bg-base-200 p-6 border border-base-300 rounded-[3px]">
          <p class="text-sm text-base-content/80">“{testimonial.quote}”</p>
          <div class="mt-4 font-semibold text-slate-500 text-xs uppercase tracking-widest">{testimonial.author}</div>
          <div class="text-sm text-base-content/70">{testimonial.role}</div>
        </div>
      ))}
    </div> -->
  </section>

  <section id="blog" class="py-16">
    <div class="section-shell">
      <div class="flex flex-wrap justify-between items-end gap-6">
        <div>
          <p class="font-semibold text-slate-500 text-xs uppercase tracking-[0.3em]">{home.blogLabel}</p>
          <h2 class="mt-3 font-semibold text-base-content text-3xl">{home.blogTitle}</h2>
          <p class="mt-3 max-w-2xl text-base-content/70">{home.blogBody}</p>
        </div>
        <a href="/blog" class="font-semibold text-sky-700 text-sm">{home.blogCta}</a>
      </div>
      <div class="gap-6 grid md:grid-cols-3 mt-10">
        {blogTeasers.map((post) => (
          <BlogCard {...post} />
        ))}
      </div>
    </div>
  </section>

  <section id="support" class="bg-base-100 py-16 border-base-300 border-t">
    <div class="gap-10 grid lg:grid-cols-[1.5fr_0.9fr] section-shell">
      <div>
        <p class="font-semibold text-slate-500 text-xs uppercase tracking-[0.3em]">{home.supportLabel}</p>
        <h2 class="mt-3 font-semibold text-base-content text-3xl">{home.supportTitle}</h2>
        <p class="mt-3 text-base-content/70">{home.supportBody}</p>
        <div class="flex flex-wrap gap-4 mt-6">
          <a href="/support" class="text-white btn btn-primary">{home.supportCtaPrimary}</a>
          <a href="mailto:contact@erudika.com" class="border border-slate-300 btn btn-ghost">{home.supportCtaSecondary}</a>
        </div>
      </div>
      <div class="p-4 border border-base-300 rounded-[3px]">
        <div class="overflow-x-auto">
          <table class="table">
            <thead>
              <tr>
                <th class="min-w-[140px]"></th>
                <th>Basic Support</th>
                <th>Priority Support</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Response time</td>
                <td class="text-orange-700 text-center">within 24h</td>
                <td class="text-green-700 text-center">within 3h</td>
              </tr>
              <tr>
                <td>Email</td>
                <td class="text-green-700 text-center">✔</td>
                <td class="text-green-700 text-center">✔</td>
              </tr>
              <tr>
                <td>Support Chat</td>
                <td class="text-green-700 text-center">✔</td>
                <td class="text-green-700 text-center">✔</td>
              </tr>
              <tr>
                <td>GitHub Issues</td>
                <td class="text-green-700 text-center">✔</td>
                <td class="text-green-700 text-center">✔</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>
