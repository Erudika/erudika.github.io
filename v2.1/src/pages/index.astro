---
import BaseLayout from "../layouts/BaseLayout.astro";
import ProjectCard from "../components/ProjectCard.astro";
import BlogCard from "../components/BlogCard.astro";
import MetricCard from "../components/MetricCard.astro";
import marketing from "../data/site-data.json";
import { getCollection } from "astro:content";

const { hero, projectHighlights, proofPoints, quickJumpChips, trustRail } = marketing;
const { home } = marketing.site.pages;

const blogTeasers = (await getCollection("blog"))
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 2)
  .map((post) => ({
    title: post.data.title,
    excerpt: post.data.excerpt,
    date: post.data.date.toLocaleDateString("en-US", {
      year: "numeric",
      month: "short",
      day: "2-digit"
    }),
    tags: post.data.tags,
    href: `/blog/${post.slug}`
  }));

const orgJsonLd = {
  "@context": "https://schema.org",
  "@type": "Organization",
  name: marketing.site.organization.name,
  url: marketing.site.organization.url,
  logo: marketing.site.organization.logo,
  email: marketing.site.organization.email,
  address: {
    "@type": "PostalAddress",
    streetAddress: marketing.site.organization.address.street,
    addressLocality: marketing.site.organization.address.locality,
    postalCode: marketing.site.organization.address.postalCode,
    addressCountry: marketing.site.organization.address.country
  }
};

const websiteJsonLd = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  name: marketing.site.organization.name,
  url: marketing.site.organization.url,
  publisher: {
    "@type": "Organization",
    name: marketing.site.organization.name
  }
};
---

<BaseLayout
  title={marketing.site.meta.home.title}
  description={marketing.site.meta.home.description}
  canonical={marketing.site.meta.home.canonical}
  jsonLd={[orgJsonLd, websiteJsonLd]}
>
  <section class="hero-grid border-b border-base-300 py-20">
    <div class="section-shell">
      <div class="mx-auto flex max-w-3xl flex-col items-center text-center">
        <p class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-500">{hero.eyebrow}</p>
        <div class="mt-6 space-y-4">
          <h1 class="text-4xl font-semibold leading-tight text-base-content sm:text-5xl">{hero.title}</h1>
          <p class="text-lg text-base-content/70">{hero.subtitle}</p>
        </div>
        <div class="mt-6 flex flex-wrap justify-center gap-3">
          {hero.badges.map((badge) => (
            <div class="rounded-[3px] border border-sky-100 bg-sky-50 px-4 py-2 text-xs font-semibold text-sky-700">
              {badge.label}
              <span class="block text-[11px] font-normal text-sky-500">{badge.description}</span>
            </div>
          ))}
        </div>
        <div class="mt-8 flex flex-wrap justify-center gap-4">
          <a href={hero.primaryCta.href} class="btn btn-primary text-white">
            {hero.primaryCta.label}
          </a>
          <a href={hero.secondaryCta.href} class="btn btn-ghost border border-slate-300">
            {hero.secondaryCta.label}
          </a>
        </div>
      </div>
    </div>
  </section>

  <section id="projects" class="py-16">
    <div class="section-shell">
      <div class="flex flex-wrap items-end justify-between gap-6">
        <div>
          <p class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-500">{home.projectsLabel}</p>
          <h2 class="mt-3 text-3xl font-semibold text-base-content">{home.projectsTitle}</h2>
          <p class="mt-3 max-w-2xl text-base-content/70">{home.projectsBody}</p>
        </div>
        <a href="/projects" class="text-sm font-semibold text-sky-700">{home.projectsCta}</a>
      </div>
      <div class="mt-10 grid gap-6 md:grid-cols-2 xl:grid-cols-3">
        {projectHighlights.map((project) => (
          <ProjectCard
            name={project.name}
            tagline={project.tagline}
            category={project.category}
            cta={project.cta}
            signal={project.signal}
            logo={`/old-website-assets/img/${project.id === "scoold" ? "scoold_logo.png" : project.id === "para" ? "para_logo.png" : "para_cloud.png"}`}
          />
        ))}
      </div>
    </div>
  </section>

  <section class="border-t border-base-300 bg-base-100 py-16">
    <div class="section-shell grid gap-10 lg:grid-cols-[0.8fr_1.2fr]">
      <div>
        <p class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-500">{home.proofLabel}</p>
        <h2 class="mt-3 text-3xl font-semibold text-base-content">{home.proofTitle}</h2>
        <p class="mt-3 text-base-content/70">{home.proofBody}</p>
      </div>
      <div class="grid gap-4 sm:grid-cols-3">
        {proofPoints.metrics.map((metric) => (
          <MetricCard label={metric.label} value={metric.value} description={metric.description} />
        ))}
      </div>
    </div>
    <div class="section-shell mt-10 grid gap-6 md:grid-cols-2">
      {proofPoints.testimonials.map((testimonial) => (
        <div class="rounded-[3px] border border-base-300 bg-base-200 p-6">
          <p class="text-sm text-base-content/80">“{testimonial.quote}”</p>
          <div class="mt-4 text-xs font-semibold uppercase tracking-widest text-slate-500">{testimonial.author}</div>
          <div class="text-sm text-base-content/70">{testimonial.role}</div>
        </div>
      ))}
    </div>
  </section>

  <section id="blog" class="py-16">
    <div class="section-shell">
      <div class="flex flex-wrap items-end justify-between gap-6">
        <div>
          <p class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-500">{home.blogLabel}</p>
          <h2 class="mt-3 text-3xl font-semibold text-base-content">{home.blogTitle}</h2>
          <p class="mt-3 max-w-2xl text-base-content/70">{home.blogBody}</p>
        </div>
        <a href="/blog" class="text-sm font-semibold text-sky-700">{home.blogCta}</a>
      </div>
      <div class="mt-10 grid gap-6 md:grid-cols-2">
        {blogTeasers.map((post) => (
          <BlogCard {...post} />
        ))}
      </div>
    </div>
  </section>

  <section id="support" class="border-t border-base-300 bg-base-100 py-16">
    <div class="section-shell grid gap-10 lg:grid-cols-[1.5fr_0.9fr]">
      <div>
        <p class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-500">{home.supportLabel}</p>
        <h2 class="mt-3 text-3xl font-semibold text-base-content">{home.supportTitle}</h2>
        <p class="mt-3 text-base-content/70">{home.supportBody}</p>
        <div class="mt-6 flex flex-wrap gap-4">
          <a href="/support" class="btn btn-primary text-white">{home.supportCtaPrimary}</a>
          <a href="mailto:contact@erudika.com" class="btn btn-ghost border border-slate-300">{home.supportCtaSecondary}</a>
        </div>
      </div>
      <div class="rounded-[3px] border border-base-300 p-4">
        <div class="overflow-x-auto">
          <table class="table">
            <thead>
              <tr>
                <th></th>
                <th>Basic Support</th>
                <th>Priority Support</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Response time</td>
                <td class="text-orange-700">within 24h</td>
                <td class="text-green-700">within 3h</td>
              </tr>
              <tr>
                <td>Email</td>
                <td class="text-green-700">✔</td>
                <td class="text-green-700">✔</td>
              </tr>
              <tr>
                <td>Support Chat</td>
                <td class="text-green-700">✔</td>
                <td class="text-green-700">✔</td>
              </tr>
              <tr>
                <td>GitHub Issues</td>
                <td class="text-green-700">✔</td>
                <td class="text-green-700">✔</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>
